<manifest xmlns:android="http://schemas.android.com/apk/res/android">

  <!-- 这个权限声明可以保留 -->
  <uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED" />
  <uses-permission android:name="android.permission.allowlist_lockTaskPackages" />
  
  <!-- APK 更新相关权限 -->
  <uses-permission android:name="android.permission.INTERNET" />
  <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
  <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
  <uses-permission android:name="android.permission.REQUEST_INSTALL_PACKAGES" />
  <uses-permission android:name="android.permission.INSTALL_PACKAGES" />
  <!-- 亮度与音量控制相关权限 -->
  <uses-permission android:name="android.permission.WRITE_SETTINGS" />
  <uses-permission android:name="android.permission.MODIFY_AUDIO_SETTINGS" />
  <uses-permission android:name="android.permission.ACCESS_NOTIFICATION_POLICY" />

  <application>
    <receiver android:name=".BootReceiver" android:enabled="true" android:exported="true">
      <intent-filter>
        <action android:name="android.intent.action.BOOT_COMPLETED" />
      </intent-filter>
    </receiver>
    <receiver android:name=".DeviceAdminReceiver" android:permission="android.permission.BIND_DEVICE_ADMIN" android:exported="true">
      <meta-data android:name="android.app.device_admin" android:resource="@xml/device_admin_receiver" />
      <intent-filter>
        <action android:name="android.app.action.DEVICE_ADMIN_ENABLED" />
      </intent-filter>
    </receiver>
    <!-- 安装完成接收器 - 静态注册，即使应用进程被杀死也能接收广播 -->
    <!-- 监听系统的 PACKAGE_ADDED 广播，这是最可靠的方式 -->
    <receiver android:name=".InstallCompleteReceiver" android:enabled="true" android:exported="true">
      <intent-filter>
        <!-- 监听系统安装完成广播 -->
        <action android:name="android.intent.action.PACKAGE_ADDED" />
        <action android:name="android.intent.action.PACKAGE_REPLACED" />
        <data android:scheme="package" />
      </intent-filter>
      <!-- 同时监听自定义的安装完成广播 -->
      <intent-filter>
        <action android:name="${applicationId}.INSTALL_COMPLETE" />
      </intent-filter>
    </receiver>
    <!-- 定时开关机接收器 -->
    <receiver android:name=".PowerScheduleReceiver" android:enabled="true" android:exported="false">
      <intent-filter>
        <action android:name="com.riuhou.kioskmanager.SCHEDULED_SHUTDOWN" />
        <action android:name="com.riuhou.kioskmanager.SCHEDULED_BOOT" />
      </intent-filter>
    </receiver>
    
    <!-- FileProvider for APK installation -->
    <provider
        android:name="androidx.core.content.FileProvider"
        android:authorities="${applicationId}.fileprovider"
        android:exported="false"
        android:grantUriPermissions="true">
        <meta-data
            android:name="android.support.FILE_PROVIDER_PATHS"
            android:resource="@xml/file_provider_paths" />
    </provider>
  </application>

</manifest>